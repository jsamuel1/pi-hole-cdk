{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.233.0"},"children":{"PiHoleCdkStack":{"id":"PiHoleCdkStack","path":"PiHoleCdkStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"networking":{"id":"networking","path":"PiHoleCdkStack/networking","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"vpc":{"id":"vpc","path":"PiHoleCdkStack/networking/vpc","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"PiHoleCdkStack/networking/vpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"PiHoleCdkStack/networking/vpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"PiHoleCdkStack/networking/vpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"PiHoleCdkStack/networking/vpc/PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"PiHoleCdkStack/networking/vpc/PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet3":{"id":"PrivateSubnet3","path":"PiHoleCdkStack/networking/vpc/PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}}}},"rfc1918prefix":{"id":"rfc1918prefix","path":"PiHoleCdkStack/networking/rfc1918prefix","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnPrefixList","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::PrefixList","aws:cdk:cloudformation:props":{"addressFamily":"IPv4","entries":[{"cidr":"10.0.0.0/8","description":"RFC1918 10/8"},{"cidr":"172.16.0.0/12","description":"RFC1918 172.16/12"},{"cidr":"192.168.0.0/16","description":"RFC1918 192.168/16"}],"maxEntries":3,"prefixListName":"RFC1918"}}},"allow_dns_http":{"id":"allow_dns_http","path":"PiHoleCdkStack/networking/allow_dns_http","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.233.0","metadata":[{"description":"*","vpc":"*"},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addEgressRule":["*",{},"*",true]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/networking/allow_dns_http/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"AllowDNSandSSH","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"vpcId":"vpc-069f286e8b8ca3d57"}}},"from {IndirectPeer}:22":{"id":"from {IndirectPeer}:22","path":"PiHoleCdkStack/networking/allow_dns_http/from {IndirectPeer}:22","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_SSH","fromPort":22,"groupId":{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]},"ipProtocol":"tcp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixB68305A2","PrefixListId"]},"toPort":22}}},"from '{IndirectPeer2}':80":{"id":"from '{IndirectPeer2}':80","path":"PiHoleCdkStack/networking/allow_dns_http/from '{IndirectPeer2}':80","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_HTTP","fromPort":80,"groupId":{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]},"ipProtocol":"tcp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixB68305A2","PrefixListId"]},"toPort":80}}},"from '{IndirectPeer3}':53":{"id":"from '{IndirectPeer3}':53","path":"PiHoleCdkStack/networking/allow_dns_http/from '{IndirectPeer3}':53","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_DNS_over_TCP","fromPort":53,"groupId":{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]},"ipProtocol":"tcp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixB68305A2","PrefixListId"]},"toPort":53}}},"from '{IndirectPeer4}':UDP 53":{"id":"from '{IndirectPeer4}':UDP 53","path":"PiHoleCdkStack/networking/allow_dns_http/from '{IndirectPeer4}':UDP 53","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_DNS_over_UDP","fromPort":53,"groupId":{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]},"ipProtocol":"udp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixB68305A2","PrefixListId"]},"toPort":53}}},"from '{IndirectPeer5}':ICMP Type 8":{"id":"from '{IndirectPeer5}':ICMP Type 8","path":"PiHoleCdkStack/networking/allow_dns_http/from '{IndirectPeer5}':ICMP Type 8","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow ICMP Ping","fromPort":8,"groupId":{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]},"ipProtocol":"icmp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixB68305A2","PrefixListId"]},"toPort":-1}}}}}}},"storage":{"id":"storage","path":"PiHoleCdkStack/storage","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"piholepwd":{"id":"piholepwd","path":"PiHoleCdkStack/storage/piholepwd","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.233.0","metadata":[{"secretName":"*","generateSecretString":{"excludePunctuation":true,"includeSpace":false}}]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/storage/piholepwd/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"generateSecretString":{"excludePunctuation":true,"includeSpace":false},"name":"pihole-pwd"}}}}},"pihole-fs":{"id":"pihole-fs","path":"PiHoleCdkStack/storage/pihole-fs","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.FileSystem","version":"2.233.0","metadata":[{"vpc":"*","encrypted":true,"fileSystemName":"*"}]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/storage/pihole-fs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnFileSystem","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::FileSystem","aws:cdk:cloudformation:props":{"encrypted":true,"fileSystemPolicy":{"Statement":[{"Action":["elasticfilesystem:ClientRootAccess","elasticfilesystem:ClientWrite"],"Condition":{"Bool":{"elasticfilesystem:AccessedViaMountTarget":"true"}},"Effect":"Allow","Principal":{"AWS":"*"}}],"Version":"2012-10-17"},"fileSystemTags":[{"key":"Name","value":"pihole-fs"}]}}},"EfsSecurityGroup":{"id":"EfsSecurityGroup","path":"PiHoleCdkStack/storage/pihole-fs/EfsSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.233.0","metadata":[{"vpc":"*"},{"addIngressRule":["*",{},"*",false]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/storage/pihole-fs/EfsSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"PiHoleCdkStack/storage/pihole-fs/EfsSecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"tags":[{"key":"Name","value":"pihole-fs"}],"vpcId":"vpc-069f286e8b8ca3d57"}}},"from PiHoleCdkStacknetworkingallowdnshttp15F47C12:2049":{"id":"from PiHoleCdkStacknetworkingallowdnshttp15F47C12:2049","path":"PiHoleCdkStack/storage/pihole-fs/EfsSecurityGroup/from PiHoleCdkStacknetworkingallowdnshttp15F47C12:2049","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from PiHoleCdkStacknetworkingallowdnshttp15F47C12:2049","fromPort":2049,"groupId":{"Fn::GetAtt":["storagepiholefsEfsSecurityGroupACBC1060","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]},"toPort":2049}}}}},"EfsMountTarget-PrivateSubnet1":{"id":"EfsMountTarget-PrivateSubnet1","path":"PiHoleCdkStack/storage/pihole-fs/EfsMountTarget-PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnMountTarget","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::MountTarget","aws:cdk:cloudformation:props":{"fileSystemId":{"Ref":"storagepiholefs1643C501"},"securityGroups":[{"Fn::GetAtt":["storagepiholefsEfsSecurityGroupACBC1060","GroupId"]}],"subnetId":"subnet-095b069ea2f8dae96"}}},"EfsMountTarget-PrivateSubnet2":{"id":"EfsMountTarget-PrivateSubnet2","path":"PiHoleCdkStack/storage/pihole-fs/EfsMountTarget-PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnMountTarget","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::MountTarget","aws:cdk:cloudformation:props":{"fileSystemId":{"Ref":"storagepiholefs1643C501"},"securityGroups":[{"Fn::GetAtt":["storagepiholefsEfsSecurityGroupACBC1060","GroupId"]}],"subnetId":"subnet-0640a0a54147e3239"}}},"EfsMountTarget-PrivateSubnet3":{"id":"EfsMountTarget-PrivateSubnet3","path":"PiHoleCdkStack/storage/pihole-fs/EfsMountTarget-PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnMountTarget","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::MountTarget","aws:cdk:cloudformation:props":{"fileSystemId":{"Ref":"storagepiholefs1643C501"},"securityGroups":[{"Fn::GetAtt":["storagepiholefsEfsSecurityGroupACBC1060","GroupId"]}],"subnetId":"subnet-017bb34117eab1589"}}}}}}},"pihole-role":{"id":"pihole-role","path":"PiHoleCdkStack/pihole-role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"Importpihole-role":{"id":"Importpihole-role","path":"PiHoleCdkStack/pihole-role/Importpihole-role","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleCdkStack/pihole-role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonElasticFileSystemClientReadWriteAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMPatchAssociation"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchAgentServerPolicy"]]}],"policies":[{"policyName":"secretPolicy","policyDocument":{"Statement":[{"Action":["secretsmanager:DescribeSecret","secretsmanager:GetResourcePolicy","secretsmanager:GetSecretValue","secretsmanager:ListSecretVersionIds"],"Effect":"Allow","Resource":{"Ref":"storagepiholepwd56AA2350"}},{"Action":"secretsmanager:ListSecrets","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}},{"policyName":"kmsPolicy","policyDocument":{"Statement":[{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:GenerateDataKey*","kms:ReEncrypt*"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}}]}}}}},"KeyPair":{"id":"KeyPair","path":"PiHoleCdkStack/KeyPair","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"pihole-asg-launchtemplate":{"id":"pihole-asg-launchtemplate","path":"PiHoleCdkStack/pihole-asg-launchtemplate","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.LaunchTemplate","version":"2.233.0","metadata":[{"instanceType":"*","machineImage":"*","userData":"*","role":"*","securityGroup":"*","requireImdsv2":true,"keyPair":"*"}]},"children":{"Profile":{"id":"Profile","path":"PiHoleCdkStack/pihole-asg-launchtemplate/Profile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"piholerole45D2AA68"}]}}},"Resource":{"id":"Resource","path":"PiHoleCdkStack/pihole-asg-launchtemplate/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"iamInstanceProfile":{"arn":{"Fn::GetAtt":["piholeasglaunchtemplateProfile79BDF81F","Arn"]}},"imageId":{"Ref":"SsmParameterValueawsservicecanonicalubuntuserver2204stablecurrentarm64hvmebsgp2amiidC96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t4g.small","keyName":"pihole","securityGroupIds":[{"Fn::GetAtt":["networkingallowdnshttp984E9584","GroupId"]}],"tagSpecifications":[{"resourceType":"instance","tags":[{"key":"Name","value":"PiHoleCdkStack/pihole-asg-launchtemplate"}]},{"resourceType":"volume","tags":[{"key":"Name","value":"PiHoleCdkStack/pihole-asg-launchtemplate"}]}],"userData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash\nSECRET_ARN=",{"Ref":"storagepiholepwd56AA2350"},"\nEFS_ID=",{"Ref":"storagepiholefs1643C501"},"\nREV_SERVER_CIDR=192.168.0.0/16\nREV_SERVER_TARGET=192.168.1.1\n#!/bin/bash -x\n# Pi-hole v6 installation script\n# This script installs Pi-hole v6 which includes an embedded web server\n# No longer requires lighttpd or PHP as Pi-hole v6 has these built-in\n# \n# log user data output to /var/log/user-data.log\nexec > >(tee /var/log/user-data.log | logger -t user-data -s 2>/dev/console) 2>&1\n\n# Function to log with timestamp\nlog_message() {\n    echo \"[$(date '+%Y-%m-%d %H:%M:%S')] $1\"\n}\n\n# Function to retry commands with exponential backoff\nretry_command() {\n    local max_attempts=5\n    local delay=1\n    local attempt=1\n    \n    while [ $attempt -le $max_attempts ]; do\n        log_message \"Attempt $attempt of $max_attempts: $*\"\n        if \"$@\"; then\n            log_message \"Command succeeded: $*\"\n            return 0\n        else\n            log_message \"Command failed: $*\"\n            if [ $attempt -lt $max_attempts ]; then\n                log_message \"Waiting ${delay}s before retry...\"\n                sleep $delay\n                delay=$((delay * 2))\n            fi\n            attempt=$((attempt + 1))\n        fi\n    done\n    \n    log_message \"Command failed after $max_attempts attempts: $*\"\n    return 1\n}\n\nlog_message \"Starting Pi-hole v6 installation userdata script\"\n\n# upgrade packages\nlog_message \"Updating package lists and upgrading system\"\nretry_command apt update -y\nretry_command apt upgrade -y\n\n# Install essential packages (removed lighttpd, php-* packages, but kept Lua)\nlog_message \"Installing required packages\"\nretry_command apt install -y dialog unzip idn2 dns-root-data jq git binutils make wget python3-pip curl\n\n# Install Lua packages (still needed for web interface extensions and processing)\nlog_message \"Installing Lua packages for web interface processing\"\nretry_command apt install -y lua5.1 liblua5.1-0-dev lua-cjson\n\n# not amazon linux, so need to build the package\nlog_message \"Building and installing EFS utils\"\nretry_command git clone https://github.com/aws/efs-utils /tmp/efs-utils/\ncd /tmp/efs-utils\nretry_command ./build-deb.sh\nretry_command apt -y install ./build/amazon-efs-utils*deb\nretry_command pip3 install botocore --upgrade\n\n# Create pihole directory and setup EFS mount with proper error handling\nlog_message \"Setting up EFS mount for Pi-hole configuration\"\nmkdir -p /etc/pihole/\necho \"$EFS_ID:/ /etc/pihole/ efs _netdev,noresvport,tls,iam,nofail 0 0\" >>/etc/fstab\n\n# Retry EFS mount with better error handling\nlog_message \"Mounting EFS filesystem\"\nif ! retry_command mount -av; then\n    log_message \"EFS mount failed, but continuing with local storage\"\n    # Ensure directory exists even if EFS mount fails\n    mkdir -p /etc/pihole/\nfi\n\n# Verify EFS mount status\nif mountpoint -q /etc/pihole; then\n    log_message \"EFS successfully mounted to /etc/pihole\"\nelse\n    log_message \"WARNING: EFS not mounted, using local storage\"\nfi\n\n# Note: Pi-hole v6 configuration is handled via pihole.toml file created below\n\n# Setup initial blocklists for v6\nlog_message \"Setting up initial Pi-hole blocklists\"\nif [ ! -a /etc/pihole/adlists.list ]; then\n\tcat <<EOF >/etc/pihole/adlists.list\nhttps://raw.githubusercontent.com/StevenBlack/hosts/master/hosts\nhttps://v.firebog.net/hosts/Admiral.txt\nhttps://v.firebog.net/hosts/Easylist.txt\nhttps://v.firebog.net/hosts/Easyprivacy.txt\nhttps://v.firebog.net/hosts/Prigent-Ads.txt\nhttps://raw.githubusercontent.com/Perflyst/PiHoleBlocklist/master/SmartTV.txt\nEOF\nfi\n\n# Stop any existing lighttpd service (in case it's running from previous installations)\nlog_message \"Stopping any existing lighttpd service\"\nsystemctl stop lighttpd 2>/dev/null || true\nsystemctl disable lighttpd 2>/dev/null || true\n\n# Create Pi-hole v6 TOML configuration for truly unattended installation\n# Pi-hole v6 installer checks for pihole.toml OR setupVars.conf to detect fresh install\nlog_message \"Creating Pi-hole v6 TOML configuration\"\nmkdir -p /etc/pihole\n\n# Detect the primary network interface (exclude loopback)\nPIHOLE_INTERFACE=$(ip -o link show up | awk -F': ' '!/lo/ {print $2; exit}')\nlog_message \"Detected network interface: $PIHOLE_INTERFACE\"\ncat > /etc/pihole/pihole.toml << 'TOML_EOF'\n# Pi-hole v6 configuration file\n# Generated by CDK user-data script\n\n[dns]\n  upstreams = [\"1.1.1.1\", \"1.0.0.1\"]\n  CNAMEdeepInspect = true\n  blockESNI = true\n  EDNS0ECS = true\n  ignoreLocalhost = false\n  showDNSSEC = true\n  analyzeOnlyAandAAAA = false\n  piholePTR = \"PI.HOLE\"\n  replyWhenBusy = \"ALLOW\"\n  blockTTL = 2\n  domainNeeded = false\n  expandHosts = false\n  bogusPriv = false\n  dnssec = false\nTOML_EOF\n\n# Append interface setting (needs variable substitution)\ncat >> /etc/pihole/pihole.toml << EOF\n  interface = \"${PIHOLE_INTERFACE}\"\nEOF\n\ncat >> /etc/pihole/pihole.toml << 'TOML_EOF'\n  listeningMode = \"ALL\"\n  queryLogging = true\n  port = 53\n\n  [dns.domain]\n    name = \"lan\"\n    local = true\n\n  [dns.cache]\n    size = 10000\n    optimizer = 3600\n\n  [dns.blocking]\n    active = true\n    mode = \"NULL\"\n\n  [dns.specialDomains]\n    mozillaCanary = true\n    iCloudPrivateRelay = true\n\n  [dns.rateLimit]\n    count = 1000\n    interval = 60\n\nTOML_EOF\n\n# Append reverse server settings (needs variable substitution)\ncat >> /etc/pihole/pihole.toml << EOF\n  revServers = [\"true,${REV_SERVER_CIDR},${REV_SERVER_TARGET},localdomain\"]\nEOF\n\ncat >> /etc/pihole/pihole.toml << 'TOML_EOF'\n\n[dhcp]\n  active = false\n\n[resolver]\n  resolveIPv4 = true\n  resolveIPv6 = true\n  networkNames = true\n  refreshNames = \"IPV4_ONLY\"\n\n[database]\n  DBimport = true\n  maxDBdays = 365\n  DBinterval = 60\n  useWAL = true\n\n  [database.network]\n    parseARPcache = true\n    expire = 365\n\n[webserver]\n  domain = \"pi.hole\"\n  acl = \"\"\n  port = \"80o,443os,[::]:80o,[::]:443os\"\n\n  [webserver.session]\n    timeout = 1800\n    restore = true\n\n  [webserver.paths]\n    webroot = \"/var/www/html\"\n    webhome = \"/admin/\"\n\n  [webserver.api]\n    prettyJSON = false\n    pwhash = \"\"\n    cli_pw = true\n    maxHistory = 86400\n\n[files]\n  pid = \"/run/pihole-FTL.pid\"\n  database = \"/etc/pihole/pihole-FTL.db\"\n  gravity = \"/etc/pihole/gravity.db\"\n  macvendor = \"/etc/pihole/macvendor.db\"\n\n  [files.log]\n    ftl = \"/var/log/pihole/FTL.log\"\n    dnsmasq = \"/var/log/pihole/pihole.log\"\n    webserver = \"/var/log/pihole/webserver.log\"\n\n[misc]\n  privacylevel = 0\n  delay_startup = 0\n  nice = -10\n  addr2line = true\n\n[debug]\n  database = false\n  networking = false\n  queries = false\nTOML_EOF\n\nlog_message \"Pi-hole TOML configuration created\"\n\n# Install Pi-hole v6 unattended\nlog_message \"Installing Pi-hole v6\"\nretry_command wget -O /tmp/basic-install.sh https://install.pi-hole.net\nretry_command bash /tmp/basic-install.sh --unattended\n\n# Install AWS CLI\nlog_message \"Installing AWS CLI\"\nretry_command snap install aws-cli --channel=v2/candidate --classic\n\n# Wait for AWS CLI to be available\nlog_message \"Waiting for AWS CLI to be available\"\nsleep 10\n\n# Set the Pi-hole web UI password\nlog_message \"Setting Pi-hole web UI password from Secrets Manager\"\nif retry_command aws secretsmanager get-secret-value --secret-id $SECRET_ARN; then\n    PASSWORD=$(aws secretsmanager get-secret-value --secret-id $SECRET_ARN | jq .SecretString -j)\n    /usr/local/bin/pihole -a -p \"$PASSWORD\"\n    log_message \"Pi-hole password set successfully\"\nelse\n    log_message \"WARNING: Failed to retrieve password from Secrets Manager\"\nfi\n\n# Apply whitelist\nlog_message \"Applying common whitelists\"\nif retry_command git clone https://github.com/anudeepND/whitelist.git /tmp/whitelist/; then\n    python3 /tmp/whitelist/scripts/whitelist.py\n    log_message \"Whitelist applied successfully\"\nelse\n    log_message \"WARNING: Failed to apply whitelist\"\nfi\n\n# Pi-hole v6 configuration is already set via pihole.toml\n# No need for post-install CLI configuration commands\n\n# Start and enable Pi-hole FTL service\nlog_message \"Starting Pi-hole FTL service\"\nsystemctl restart pihole-FTL\nsystemctl enable pihole-FTL\n\n# Wait for service to start\nsleep 10\n\n# Verify Pi-hole FTL service is running\nlog_message \"Verifying Pi-hole FTL service status\"\nif systemctl is-active --quiet pihole-FTL; then\n    log_message \"Pi-hole FTL is running successfully\"\nelse\n    log_message \"WARNING: Pi-hole FTL failed to start\"\n    systemctl status pihole-FTL\nfi\n\n# Verify web interface is accessible on port 80\nlog_message \"Verifying Pi-hole v6 web interface accessibility\"\nsleep 5\nif curl -s -f http://localhost/admin/ >/dev/null 2>&1; then\n    log_message \"Pi-hole v6 web interface is accessible on port 80\"\nelif curl -s -f http://localhost:8080/admin/ >/dev/null 2>&1; then\n    log_message \"Pi-hole v6 web interface is accessible on port 8080 (fallback)\"\nelse\n    log_message \"WARNING: Pi-hole v6 web interface is not accessible\"\nfi\n\n# Test DNS functionality\nlog_message \"Testing DNS functionality\"\nif dig @127.0.0.1 google.com +short >/dev/null 2>&1; then\n    log_message \"DNS functionality test passed\"\nelse\n    log_message \"WARNING: DNS functionality test failed\"\nfi\n\n# Display Pi-hole v6 configuration summary\nlog_message \"Pi-hole v6 configuration summary:\"\n/usr/local/bin/pihole-FTL --config --list 2>/dev/null || log_message \"Could not retrieve configuration list\"\n\n# Check which ports Pi-hole is listening on\nlog_message \"Checking Pi-hole listening ports:\"\nnetstat -tlnp | grep pihole-FTL || log_message \"Could not determine listening ports\"\n\nlog_message \"Pi-hole v6 installation userdata script completed successfully\"\n"]]}},"metadataOptions":{"httpTokens":"required"}},"tagSpecifications":[{"resourceType":"launch-template","tags":[{"key":"Name","value":"PiHoleCdkStack/pihole-asg-launchtemplate"}]}]}}}}},"SsmParameterValue:--aws--service--canonical--ubuntu--server--22.04--stable--current--arm64--hvm--ebs-gp2--ami-id:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--aws--service--canonical--ubuntu--server--22.04--stable--current--arm64--hvm--ebs-gp2--ami-id:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"PiHoleCdkStack/SsmParameterValue:--aws--service--canonical--ubuntu--server--22.04--stable--current--arm64--hvm--ebs-gp2--ami-id:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"SsmParameterValue:--aws--service--canonical--ubuntu--server--22.04--stable--current--arm64--hvm--ebs-gp2--ami-id:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--aws--service--canonical--ubuntu--server--22.04--stable--current--arm64--hvm--ebs-gp2--ami-id:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"PiHoleCdkStack/SsmParameterValue:--aws--service--canonical--ubuntu--server--22.04--stable--current--arm64--hvm--ebs-gp2--ami-id:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"pihole-asg":{"id":"pihole-asg","path":"PiHoleCdkStack/pihole-asg","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.AutoScalingGroup","version":"2.233.0","metadata":[{"launchTemplate":"*","vpc":"*","vpcSubnets":{"subnetType":"Private"},"maxInstanceLifetime":"*","updatePolicy":"*","healthChecks":"*"},{"attachToNetworkTargetGroup":["*"]},{"attachToNetworkTargetGroup":["*"]}]},"children":{"ASG":{"id":"ASG","path":"PiHoleCdkStack/pihole-asg/ASG","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnAutoScalingGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::AutoScalingGroup","aws:cdk:cloudformation:props":{"healthCheckType":"EC2","launchTemplate":{"launchTemplateId":{"Ref":"piholeasglaunchtemplate35F914B9"},"version":{"Fn::GetAtt":["piholeasglaunchtemplate35F914B9","LatestVersionNumber"]}},"maxInstanceLifetime":604800,"maxSize":"1","minSize":"1","targetGroupArns":[{"Ref":"loadbalancernlbNLBDNSpiholesTargetsGroupBADD8C1A"},{"Ref":"loadbalancernlbNLBHTTPpiholeHttpTargetsGroup59493487"}],"vpcZoneIdentifier":["subnet-095b069ea2f8dae96","subnet-0640a0a54147e3239","subnet-017bb34117eab1589"]}}}}},"loadbalancer":{"id":"loadbalancer","path":"PiHoleCdkStack/loadbalancer","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"nlb":{"id":"nlb","path":"PiHoleCdkStack/loadbalancer/nlb","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer","version":"2.233.0","metadata":["*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/nlb/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnLoadBalancer","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::LoadBalancer","aws:cdk:cloudformation:props":{"loadBalancerAttributes":[{"key":"deletion_protection.enabled","value":"false"},{"key":"load_balancing.cross_zone.enabled","value":"true"}],"name":"pihole","scheme":"internal","securityGroups":[],"subnets":["subnet-095b069ea2f8dae96","subnet-0640a0a54147e3239","subnet-017bb34117eab1589"],"type":"network"}}},"NLBDNS":{"id":"NLBDNS","path":"PiHoleCdkStack/loadbalancer/nlb/NLBDNS","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener","version":"2.233.0","metadata":["*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/nlb/NLBDNS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::Listener","aws:cdk:cloudformation:props":{"defaultActions":[{"type":"forward","targetGroupArn":{"Ref":"loadbalancernlbNLBDNSpiholesTargetsGroupBADD8C1A"}}],"loadBalancerArn":{"Ref":"loadbalancernlbCB05B3A6"},"port":53,"protocol":"TCP_UDP"}}},"piholesTargetsGroup":{"id":"piholesTargetsGroup","path":"PiHoleCdkStack/loadbalancer/nlb/NLBDNS/piholesTargetsGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkTargetGroup","version":"2.233.0"},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/nlb/NLBDNS/piholesTargetsGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnTargetGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::TargetGroup","aws:cdk:cloudformation:props":{"port":53,"protocol":"TCP_UDP","targetGroupAttributes":[{"key":"deregistration_delay.timeout_seconds","value":"120"},{"key":"deregistration_delay.connection_termination.enabled","value":"true"}],"targetType":"instance","vpcId":"vpc-069f286e8b8ca3d57"}}}}}}},"NLBHTTP":{"id":"NLBHTTP","path":"PiHoleCdkStack/loadbalancer/nlb/NLBHTTP","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener","version":"2.233.0","metadata":["*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/nlb/NLBHTTP/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::Listener","aws:cdk:cloudformation:props":{"defaultActions":[{"type":"forward","targetGroupArn":{"Ref":"loadbalancernlbNLBHTTPpiholeHttpTargetsGroup59493487"}}],"loadBalancerArn":{"Ref":"loadbalancernlbCB05B3A6"},"port":80,"protocol":"TCP"}}},"piholeHttpTargetsGroup":{"id":"piholeHttpTargetsGroup","path":"PiHoleCdkStack/loadbalancer/nlb/NLBHTTP/piholeHttpTargetsGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkTargetGroup","version":"2.233.0"},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/nlb/NLBHTTP/piholeHttpTargetsGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnTargetGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::TargetGroup","aws:cdk:cloudformation:props":{"healthCheckPath":"/admin/","healthCheckProtocol":"HTTP","port":80,"protocol":"TCP","targetGroupAttributes":[{"key":"deregistration_delay.timeout_seconds","value":"120"}],"targetType":"instance","vpcId":"vpc-069f286e8b8ca3d57"}}}}}}}}},"GetEndpointIps":{"id":"GetEndpointIps","path":"PiHoleCdkStack/loadbalancer/GetEndpointIps","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"PiHoleCdkStack/loadbalancer/GetEndpointIps/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/GetEndpointIps/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*","*","*","*","*"]},"children":{"Default":{"id":"Default","path":"PiHoleCdkStack/loadbalancer/GetEndpointIps/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"PiHoleCdkStack/loadbalancer/GetEndpointIps/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/loadbalancer/GetEndpointIps/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"ec2:DescribeNetworkInterfaces","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"loadbalancerGetEndpointIpsCustomResourcePolicy4ECFB2FD","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}}}},"AWS679f53fac002430cb0da5b7982bd2287":{"id":"AWS679f53fac002430cb0da5b7982bd2287","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[{"memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[{"attachInlinePolicy":["*"]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Code":{"id":"Code","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-717494614307-us-west-2","s3Key":"bc8ef58951f4c88e641dd23090e9d2e2e61c7530a07960e767522941e959b625.zip"},"handler":"index.handler","role":{"Fn::GetAtt":["AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2","Arn"]},"runtime":"nodejs22.x","timeout":120}}},"LogGroup":{"id":"LogGroup","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.233.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"PiHoleCdkStack/AWS679f53fac002430cb0da5b7982bd2287/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"AWS679f53fac002430cb0da5b7982bd22872D164C4C"}]]},"retentionInDays":731}}}}}}},"dns1":{"id":"dns1","path":"PiHoleCdkStack/dns1","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"dns2":{"id":"dns2","path":"PiHoleCdkStack/dns2","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"admin-url":{"id":"admin-url","path":"PiHoleCdkStack/admin-url","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"SecretArn":{"id":"SecretArn","path":"PiHoleCdkStack/SecretArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"RFC1918PrefixListId":{"id":"RFC1918PrefixListId","path":"PiHoleCdkStack/RFC1918PrefixListId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"PiHoleCdkStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"PiHoleCdkStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"PiHoleCdkStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"PiHoleCdkStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"PiHoleEcsManagedStack":{"id":"PiHoleEcsManagedStack","path":"PiHoleEcsManagedStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"networking":{"id":"networking","path":"PiHoleEcsManagedStack/networking","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"vpc":{"id":"vpc","path":"PiHoleEcsManagedStack/networking/vpc","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"PiHoleEcsManagedStack/networking/vpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"PiHoleEcsManagedStack/networking/vpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"PiHoleEcsManagedStack/networking/vpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"PiHoleEcsManagedStack/networking/vpc/PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"PiHoleEcsManagedStack/networking/vpc/PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet3":{"id":"PrivateSubnet3","path":"PiHoleEcsManagedStack/networking/vpc/PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}}}},"rfc1918prefix-ecs":{"id":"rfc1918prefix-ecs","path":"PiHoleEcsManagedStack/networking/rfc1918prefix-ecs","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnPrefixList","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::PrefixList","aws:cdk:cloudformation:props":{"addressFamily":"IPv4","entries":[{"cidr":"10.0.0.0/8","description":"RFC1918 10/8"},{"cidr":"172.16.0.0/12","description":"RFC1918 172.16/12"},{"cidr":"192.168.0.0/16","description":"RFC1918 192.168/16"}],"maxEntries":3,"prefixListName":"RFC1918-ecs"}}},"allow_dns_http-ecs":{"id":"allow_dns_http-ecs","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.233.0","metadata":[{"description":"*","vpc":"*"},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":[{"canInlineRule":false,"connections":"*","uniqueId":"*"},{},"*"]},{"addEgressRule":["*",{},"*",true]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"AllowDNSandSSH-ecs","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"vpcId":"vpc-069f286e8b8ca3d57"}}},"from {IndirectPeer}:22":{"id":"from {IndirectPeer}:22","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs/from {IndirectPeer}:22","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_SSH","fromPort":22,"groupId":{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]},"ipProtocol":"tcp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixecs1B769745","PrefixListId"]},"toPort":22}}},"from '{IndirectPeer2}':80":{"id":"from '{IndirectPeer2}':80","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs/from '{IndirectPeer2}':80","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_HTTP","fromPort":80,"groupId":{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]},"ipProtocol":"tcp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixecs1B769745","PrefixListId"]},"toPort":80}}},"from '{IndirectPeer3}':53":{"id":"from '{IndirectPeer3}':53","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs/from '{IndirectPeer3}':53","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_DNS_over_TCP","fromPort":53,"groupId":{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]},"ipProtocol":"tcp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixecs1B769745","PrefixListId"]},"toPort":53}}},"from '{IndirectPeer4}':UDP 53":{"id":"from '{IndirectPeer4}':UDP 53","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs/from '{IndirectPeer4}':UDP 53","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow_DNS_over_UDP","fromPort":53,"groupId":{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]},"ipProtocol":"udp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixecs1B769745","PrefixListId"]},"toPort":53}}},"from '{IndirectPeer5}':ICMP Type 8":{"id":"from '{IndirectPeer5}':ICMP Type 8","path":"PiHoleEcsManagedStack/networking/allow_dns_http-ecs/from '{IndirectPeer5}':ICMP Type 8","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"Allow ICMP Ping","fromPort":8,"groupId":{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]},"ipProtocol":"icmp","sourcePrefixListId":{"Fn::GetAtt":["networkingrfc1918prefixecs1B769745","PrefixListId"]},"toPort":-1}}}}}}},"storage":{"id":"storage","path":"PiHoleEcsManagedStack/storage","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"piholepwd-ecs":{"id":"piholepwd-ecs","path":"PiHoleEcsManagedStack/storage/piholepwd-ecs","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.233.0","metadata":[{"secretName":"*","generateSecretString":{"excludePunctuation":true,"includeSpace":false}}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/storage/piholepwd-ecs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"generateSecretString":{"excludePunctuation":true,"includeSpace":false},"name":"pihole-pwd-ecs"}}}}},"pihole-fs-ecs":{"id":"pihole-fs-ecs","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.FileSystem","version":"2.233.0","metadata":[{"vpc":"*","encrypted":true,"fileSystemName":"*"}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnFileSystem","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::FileSystem","aws:cdk:cloudformation:props":{"encrypted":true,"fileSystemPolicy":{"Statement":[{"Action":["elasticfilesystem:ClientRootAccess","elasticfilesystem:ClientWrite"],"Condition":{"Bool":{"elasticfilesystem:AccessedViaMountTarget":"true"}},"Effect":"Allow","Principal":{"AWS":"*"}}],"Version":"2012-10-17"},"fileSystemTags":[{"key":"Name","value":"pihole-fs-ecs"}]}}},"EfsSecurityGroup":{"id":"EfsSecurityGroup","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.233.0","metadata":[{"vpc":"*"},{"addIngressRule":["*",{},"*",false]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsSecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"tags":[{"key":"Name","value":"pihole-fs-ecs"}],"vpcId":"vpc-069f286e8b8ca3d57"}}},"from PiHoleEcsManagedStacknetworkingallowdnshttpecs7854684B:2049":{"id":"from PiHoleEcsManagedStacknetworkingallowdnshttpecs7854684B:2049","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsSecurityGroup/from PiHoleEcsManagedStacknetworkingallowdnshttpecs7854684B:2049","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from PiHoleEcsManagedStacknetworkingallowdnshttpecs7854684B:2049","fromPort":2049,"groupId":{"Fn::GetAtt":["storagepiholefsecsEfsSecurityGroupDAFFAD23","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]},"toPort":2049}}}}},"EfsMountTarget-PrivateSubnet1":{"id":"EfsMountTarget-PrivateSubnet1","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsMountTarget-PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnMountTarget","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::MountTarget","aws:cdk:cloudformation:props":{"fileSystemId":{"Ref":"storagepiholefsecs89BA1EFE"},"securityGroups":[{"Fn::GetAtt":["storagepiholefsecsEfsSecurityGroupDAFFAD23","GroupId"]}],"subnetId":"subnet-095b069ea2f8dae96"}}},"EfsMountTarget-PrivateSubnet2":{"id":"EfsMountTarget-PrivateSubnet2","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsMountTarget-PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnMountTarget","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::MountTarget","aws:cdk:cloudformation:props":{"fileSystemId":{"Ref":"storagepiholefsecs89BA1EFE"},"securityGroups":[{"Fn::GetAtt":["storagepiholefsecsEfsSecurityGroupDAFFAD23","GroupId"]}],"subnetId":"subnet-0640a0a54147e3239"}}},"EfsMountTarget-PrivateSubnet3":{"id":"EfsMountTarget-PrivateSubnet3","path":"PiHoleEcsManagedStack/storage/pihole-fs-ecs/EfsMountTarget-PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.aws_efs.CfnMountTarget","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EFS::MountTarget","aws:cdk:cloudformation:props":{"fileSystemId":{"Ref":"storagepiholefsecs89BA1EFE"},"securityGroups":[{"Fn::GetAtt":["storagepiholefsecsEfsSecurityGroupDAFFAD23","GroupId"]}],"subnetId":"subnet-017bb34117eab1589"}}}}}}},"pihole-ecs-cluster":{"id":"pihole-ecs-cluster","path":"PiHoleEcsManagedStack/pihole-ecs-cluster","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Cluster","version":"2.233.0","metadata":[{"clusterName":"*","vpc":"*","enableFargateCapacityProviders":false},{"addManagedInstancesCapacityProvider":["*"]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-ecs-cluster/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCluster","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Cluster","aws:cdk:cloudformation:props":{"clusterName":"pihole-cluster"}}}}},"pihole-task-execution-role":{"id":"pihole-task-execution-role","path":"PiHoleEcsManagedStack/pihole-task-execution-role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"addToPrincipalPolicy":[{}]}]},"children":{"Importpihole-task-execution-role":{"id":"Importpihole-task-execution-role","path":"PiHoleEcsManagedStack/pihole-task-execution-role/Importpihole-task-execution-role","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-task-execution-role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"PiHoleEcsManagedStack/pihole-task-execution-role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-task-execution-role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["piholelogs4B59571B","Arn"]}},{"Action":["secretsmanager:DescribeSecret","secretsmanager:GetSecretValue"],"Effect":"Allow","Resource":{"Ref":"storagepiholepwdecsCA268013"}}],"Version":"2012-10-17"},"policyName":"piholetaskexecutionroleDefaultPolicyDA0A6144","roles":[{"Ref":"piholetaskexecutionrole1FC77441"}]}}}}}}},"pihole-task-role":{"id":"pihole-task-role","path":"PiHoleEcsManagedStack/pihole-task-role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]}]},"children":{"Importpihole-task-role":{"id":"Importpihole-task-role","path":"PiHoleEcsManagedStack/pihole-task-role/Importpihole-task-role","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-task-role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonElasticFileSystemClientReadWriteAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMPatchAssociation"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchAgentServerPolicy"]]}],"policies":[{"policyName":"secretPolicy","policyDocument":{"Statement":[{"Action":["secretsmanager:DescribeSecret","secretsmanager:GetResourcePolicy","secretsmanager:GetSecretValue","secretsmanager:ListSecretVersionIds"],"Effect":"Allow","Resource":{"Ref":"storagepiholepwdecsCA268013"}},{"Action":"secretsmanager:ListSecrets","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}},{"policyName":"kmsPolicy","policyDocument":{"Statement":[{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:GenerateDataKey*","kms:ReEncrypt*"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"PiHoleEcsManagedStack/pihole-task-role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-task-role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ssmmessages:CreateControlChannel","ssmmessages:CreateDataChannel","ssmmessages:OpenControlChannel","ssmmessages:OpenDataChannel"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"piholetaskroleDefaultPolicy3071A014","roles":[{"Ref":"piholetaskroleEB827945"}]}}}}}}},"pihole-logs":{"id":"pihole-logs","path":"PiHoleEcsManagedStack/pihole-logs","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.233.0","metadata":[{"logGroupName":"*","retention":7,"removalPolicy":"destroy"}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-logs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/ecs/pihole","retentionInDays":7}}}}},"pihole-task-def":{"id":"pihole-task-def","path":"PiHoleEcsManagedStack/pihole-task-def","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Ec2TaskDefinition","version":"2.233.0","metadata":["*","*","*","*","*","*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-task-def/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnTaskDefinition","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::TaskDefinition","aws:cdk:cloudformation:props":{"containerDefinitions":[{"cpu":256,"essential":true,"image":"pihole/pihole:latest","memoryReservation":512,"mountPoints":[{"containerPath":"/etc/pihole","readOnly":false,"sourceVolume":"pihole-config"}],"name":"pihole","portMappings":[{"containerPort":53,"protocol":"tcp"},{"containerPort":53,"protocol":"udp"},{"containerPort":80,"protocol":"tcp"}],"logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"piholelogs4B59571B"},"awslogs-stream-prefix":"pihole","awslogs-region":"us-west-2"}},"environment":[{"name":"TZ","value":"UTC"},{"name":"REV_SERVER","value":"true"},{"name":"REV_SERVER_CIDR","value":"192.168.0.0/16"},{"name":"REV_SERVER_TARGET","value":"192.168.1.1"},{"name":"REV_SERVER_DOMAIN","value":"localdomain"},{"name":"DNS1","value":"1.1.1.1"},{"name":"DNS2","value":"1.0.0.1"},{"name":"DNSMASQ_LISTENING","value":"all"}],"secrets":[{"name":"WEBPASSWORD","valueFrom":{"Ref":"storagepiholepwdecsCA268013"}}],"healthCheck":{"command":["CMD-SHELL","dig @127.0.0.1 google.com +short || exit 1"],"interval":30,"retries":3,"startPeriod":60,"timeout":5}}],"executionRoleArn":{"Fn::GetAtt":["piholetaskexecutionrole1FC77441","Arn"]},"family":"PiHoleEcsManagedStackpiholetaskdef48D30F16","networkMode":"host","requiresCompatibilities":["EC2"],"taskRoleArn":{"Fn::GetAtt":["piholetaskroleEB827945","Arn"]},"volumes":[{"name":"pihole-config","efsVolumeConfiguration":{"filesystemId":{"Ref":"storagepiholefsecs89BA1EFE"},"authorizationConfig":{"iam":"ENABLED"},"transitEncryption":"ENABLED"}}]}}},"pihole":{"id":"pihole","path":"PiHoleEcsManagedStack/pihole-task-def/pihole","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.233.0"}}}},"pihole-instance-role":{"id":"pihole-instance-role","path":"PiHoleEcsManagedStack/pihole-instance-role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"Importpihole-instance-role":{"id":"Importpihole-instance-role","path":"PiHoleEcsManagedStack/pihole-instance-role/Importpihole-instance-role","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-instance-role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonElasticFileSystemClientReadWriteAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMPatchAssociation"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchAgentServerPolicy"]]}]}}}}},"pihole-instance-profile":{"id":"pihole-instance-profile","path":"PiHoleEcsManagedStack/pihole-instance-profile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.InstanceProfile","version":"2.233.0","metadata":[{"role":"*","instanceProfileName":"*"}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-instance-profile/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"instanceProfileName":"pihole-ecs-instance-profile","roles":[{"Ref":"piholeinstancerole686FA222"}]}}}}},"pihole-capacity-provider":{"id":"pihole-capacity-provider","path":"PiHoleEcsManagedStack/pihole-capacity-provider","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ManagedInstancesCapacityProvider","version":"2.233.0"},"children":{"pihole-capacity-providerRole":{"id":"pihole-capacity-providerRole","path":"PiHoleEcsManagedStack/pihole-capacity-provider/pihole-capacity-providerRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"Importpihole-capacity-providerRole":{"id":"Importpihole-capacity-providerRole","path":"PiHoleEcsManagedStack/pihole-capacity-provider/pihole-capacity-providerRole/Importpihole-capacity-providerRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/pihole-capacity-provider/pihole-capacity-providerRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonECSInfrastructureRolePolicyForManagedInstances"]]}]}}}}},"pihole-capacity-provider":{"id":"pihole-capacity-provider","path":"PiHoleEcsManagedStack/pihole-capacity-provider/pihole-capacity-provider","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCapacityProvider","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::CapacityProvider","aws:cdk:cloudformation:props":{"clusterName":{"Ref":"piholeecscluster1D110B90"},"managedInstancesProvider":{"infrastructureRoleArn":{"Fn::GetAtt":["piholecapacityproviderpiholecapacityproviderRole1D67EF27","Arn"]},"instanceLaunchTemplate":{"ec2InstanceProfileArn":{"Fn::GetAtt":["piholeinstanceprofile394DFD0D","Arn"]},"networkConfiguration":{"subnets":["subnet-095b069ea2f8dae96","subnet-0640a0a54147e3239","subnet-017bb34117eab1589"],"securityGroups":[{"Fn::GetAtt":["networkingallowdnshttpecs207FEFBB","GroupId"]}]},"storageConfiguration":{"storageSizeGiB":30},"monitoring":"DETAILED","instanceRequirements":{"vCpuCount":{"min":2,"max":4},"memoryMiB":{"min":2048,"max":4096},"cpuManufacturers":["amazon-web-services"]}}},"name":"pihole-managed-instances"}}}}},"pihole-service":{"id":"pihole-service","path":"PiHoleEcsManagedStack/pihole-service","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Ec2Service","version":"2.233.0","metadata":["*","*"]},"children":{"Service":{"id":"Service","path":"PiHoleEcsManagedStack/pihole-service/Service","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnService","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Service","aws:cdk:cloudformation:props":{"capacityProviderStrategy":[{"capacityProvider":{"Ref":"piholecapacityprovider817635A6"},"weight":1,"base":1}],"cluster":{"Ref":"piholeecscluster1D110B90"},"deploymentConfiguration":{"maximumPercent":100,"minimumHealthyPercent":0},"desiredCount":1,"enableEcsManagedTags":false,"enableExecuteCommand":true,"healthCheckGracePeriodSeconds":60,"loadBalancers":[{"targetGroupArn":{"Ref":"loadbalancernlbNLBDNSpiholesTargetsGroupBADD8C1A"},"containerName":"pihole","containerPort":53}],"placementConstraints":[{"type":"distinctInstance"}],"schedulingStrategy":"REPLICA","serviceName":"pihole-service","taskDefinition":{"Ref":"piholetaskdefF10C26F3"}}}}}},"loadbalancer":{"id":"loadbalancer","path":"PiHoleEcsManagedStack/loadbalancer","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"nlb":{"id":"nlb","path":"PiHoleEcsManagedStack/loadbalancer/nlb","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer","version":"2.233.0","metadata":["*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/nlb/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnLoadBalancer","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::LoadBalancer","aws:cdk:cloudformation:props":{"loadBalancerAttributes":[{"key":"deletion_protection.enabled","value":"false"},{"key":"load_balancing.cross_zone.enabled","value":"true"}],"name":"pihole-ecs","scheme":"internal","securityGroups":[],"subnets":["subnet-095b069ea2f8dae96","subnet-0640a0a54147e3239","subnet-017bb34117eab1589"],"type":"network"}}},"NLBDNS":{"id":"NLBDNS","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBDNS","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener","version":"2.233.0","metadata":["*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBDNS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::Listener","aws:cdk:cloudformation:props":{"defaultActions":[{"type":"forward","targetGroupArn":{"Ref":"loadbalancernlbNLBDNSpiholesTargetsGroupBADD8C1A"}}],"loadBalancerArn":{"Ref":"loadbalancernlbCB05B3A6"},"port":53,"protocol":"TCP_UDP"}}},"piholesTargetsGroup":{"id":"piholesTargetsGroup","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBDNS/piholesTargetsGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkTargetGroup","version":"2.233.0"},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBDNS/piholesTargetsGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnTargetGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::TargetGroup","aws:cdk:cloudformation:props":{"port":53,"protocol":"TCP_UDP","targetGroupAttributes":[{"key":"deregistration_delay.timeout_seconds","value":"120"},{"key":"deregistration_delay.connection_termination.enabled","value":"true"}],"vpcId":"vpc-069f286e8b8ca3d57"}}}}}}},"NLBHTTP":{"id":"NLBHTTP","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBHTTP","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener","version":"2.233.0","metadata":["*","*","*"]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBHTTP/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::Listener","aws:cdk:cloudformation:props":{"defaultActions":[{"type":"forward","targetGroupArn":{"Ref":"loadbalancernlbNLBHTTPpiholeHttpTargetsGroup59493487"}}],"loadBalancerArn":{"Ref":"loadbalancernlbCB05B3A6"},"port":80,"protocol":"TCP"}}},"piholeHttpTargetsGroup":{"id":"piholeHttpTargetsGroup","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBHTTP/piholeHttpTargetsGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.NetworkTargetGroup","version":"2.233.0"},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/nlb/NLBHTTP/piholeHttpTargetsGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_elasticloadbalancingv2.CfnTargetGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ElasticLoadBalancingV2::TargetGroup","aws:cdk:cloudformation:props":{"healthCheckPath":"/admin/","healthCheckProtocol":"HTTP","port":80,"protocol":"TCP","targetGroupAttributes":[{"key":"deregistration_delay.timeout_seconds","value":"120"}],"vpcId":"vpc-069f286e8b8ca3d57"}}}}}}}}},"GetEndpointIps":{"id":"GetEndpointIps","path":"PiHoleEcsManagedStack/loadbalancer/GetEndpointIps","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"PiHoleEcsManagedStack/loadbalancer/GetEndpointIps/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/GetEndpointIps/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*","*","*","*","*"]},"children":{"Default":{"id":"Default","path":"PiHoleEcsManagedStack/loadbalancer/GetEndpointIps/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"PiHoleEcsManagedStack/loadbalancer/GetEndpointIps/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/loadbalancer/GetEndpointIps/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"ec2:DescribeNetworkInterfaces","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"loadbalancerGetEndpointIpsCustomResourcePolicy4ECFB2FD","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}}}},"AWS679f53fac002430cb0da5b7982bd2287":{"id":"AWS679f53fac002430cb0da5b7982bd2287","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[{"memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[{"attachInlinePolicy":["*"]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Code":{"id":"Code","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-717494614307-us-west-2","s3Key":"bc8ef58951f4c88e641dd23090e9d2e2e61c7530a07960e767522941e959b625.zip"},"handler":"index.handler","role":{"Fn::GetAtt":["AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2","Arn"]},"runtime":"nodejs22.x","timeout":120}}},"LogGroup":{"id":"LogGroup","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.233.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"PiHoleEcsManagedStack/AWS679f53fac002430cb0da5b7982bd2287/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"AWS679f53fac002430cb0da5b7982bd22872D164C4C"}]]},"retentionInDays":731}}}}}}},"dns1-ecs":{"id":"dns1-ecs","path":"PiHoleEcsManagedStack/dns1-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"dns2-ecs":{"id":"dns2-ecs","path":"PiHoleEcsManagedStack/dns2-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"admin-url-ecs":{"id":"admin-url-ecs","path":"PiHoleEcsManagedStack/admin-url-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"SecretArn-ecs":{"id":"SecretArn-ecs","path":"PiHoleEcsManagedStack/SecretArn-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"RFC1918PrefixListId-ecs":{"id":"RFC1918PrefixListId-ecs","path":"PiHoleEcsManagedStack/RFC1918PrefixListId-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"ClusterName-ecs":{"id":"ClusterName-ecs","path":"PiHoleEcsManagedStack/ClusterName-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"ServiceName-ecs":{"id":"ServiceName-ecs","path":"PiHoleEcsManagedStack/ServiceName-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"EfsFileSystemId-ecs":{"id":"EfsFileSystemId-ecs","path":"PiHoleEcsManagedStack/EfsFileSystemId-ecs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"PiHoleEcsManagedStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"PiHoleEcsManagedStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"PiHoleEcsManagedStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"PiHoleEcsManagedStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"SiteToSiteVpnStack":{"id":"SiteToSiteVpnStack","path":"SiteToSiteVpnStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"vpc":{"id":"vpc","path":"SiteToSiteVpnStack/vpc","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"SiteToSiteVpnStack/vpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"SiteToSiteVpnStack/vpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"SiteToSiteVpnStack/vpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"SiteToSiteVpnStack/vpc/PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"SiteToSiteVpnStack/vpc/PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet3":{"id":"PrivateSubnet3","path":"SiteToSiteVpnStack/vpc/PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"sitetositevpn":{"id":"sitetositevpn","path":"SiteToSiteVpnStack/vpc/sitetositevpn","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.VpnConnection","version":"2.233.0","metadata":[{"vpc":"*","ip":"*","staticRoutes":"*"}]},"children":{"CustomerGateway":{"id":"CustomerGateway","path":"SiteToSiteVpnStack/vpc/sitetositevpn/CustomerGateway","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnCustomerGateway","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::CustomerGateway","aws:cdk:cloudformation:props":{"bgpAsn":65000,"ipAddress":"127.0.0.1","type":"ipsec.1"}}},"Resource":{"id":"Resource","path":"SiteToSiteVpnStack/vpc/sitetositevpn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPNConnection","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPNConnection","aws:cdk:cloudformation:props":{"customerGatewayId":{"Ref":"vpcsitetositevpnCustomerGatewayD928C567"},"staticRoutesOnly":true,"type":"ipsec.1","vpnGatewayId":{"Ref":"vpcVpnGateway3B5265B5"}}}},"Route1921680016":{"id":"Route1921680016","path":"SiteToSiteVpnStack/vpc/sitetositevpn/Route1921680016","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPNConnectionRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPNConnectionRoute","aws:cdk:cloudformation:props":{"destinationCidrBlock":"192.168.0.0/16","vpnConnectionId":{"Ref":"vpcsitetositevpnACFC548E"}}}}}},"VpnGateway":{"id":"VpnGateway","path":"SiteToSiteVpnStack/vpc/VpnGateway","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.VpnGateway","version":"2.233.0","metadata":[{"amazonSideAsn":"*","type":"*"}]},"children":{"Default":{"id":"Default","path":"SiteToSiteVpnStack/vpc/VpnGateway/Default","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPNGateway","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPNGateway","aws:cdk:cloudformation:props":{"type":"ipsec.1"}}}}},"VPCVPNGW":{"id":"VPCVPNGW","path":"SiteToSiteVpnStack/vpc/VPCVPNGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCGatewayAttachment","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCGatewayAttachment","aws:cdk:cloudformation:props":{"vpcId":"vpc-069f286e8b8ca3d57","vpnGatewayId":{"Ref":"vpcVpnGateway3B5265B5"}}}},"RoutePropagation":{"id":"RoutePropagation","path":"SiteToSiteVpnStack/vpc/RoutePropagation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPNGatewayRoutePropagation","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPNGatewayRoutePropagation","aws:cdk:cloudformation:props":{"routeTableIds":["rtb-0e1b5c4a33d9d952d","rtb-0d3c5812eee1ab0e3","rtb-03fd923d374e6be92"],"vpnGatewayId":{"Ref":"vpcVpnGateway3B5265B5"}}}}}},"CDKMetadata":{"id":"CDKMetadata","path":"SiteToSiteVpnStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"SiteToSiteVpnStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"SiteToSiteVpnStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"SiteToSiteVpnStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"TgwWithSiteToSiteVpnStack":{"id":"TgwWithSiteToSiteVpnStack","path":"TgwWithSiteToSiteVpnStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"vpc":{"id":"vpc","path":"TgwWithSiteToSiteVpnStack/vpc","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"TgwWithSiteToSiteVpnStack/vpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"TgwWithSiteToSiteVpnStack/vpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"TgwWithSiteToSiteVpnStack/vpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"TgwWithSiteToSiteVpnStack/vpc/PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"TgwWithSiteToSiteVpnStack/vpc/PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"PrivateSubnet3":{"id":"PrivateSubnet3","path":"TgwWithSiteToSiteVpnStack/vpc/PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}}}},"tgw":{"id":"tgw","path":"TgwWithSiteToSiteVpnStack/tgw","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnTransitGateway","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::TransitGateway","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"pihole-tgw"}]}}},"GetDefaultRouteTableId":{"id":"GetDefaultRouteTableId","path":"TgwWithSiteToSiteVpnStack/tgw/GetDefaultRouteTableId","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw/GetDefaultRouteTableId/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw/GetDefaultRouteTableId/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*","*","*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw/GetDefaultRouteTableId/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw/GetDefaultRouteTableId/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw/GetDefaultRouteTableId/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"ec2:DescribeTransitGateways","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwGetDefaultRouteTableIdCustomResourcePolicy98FAE2A5","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}}}},"AWS679f53fac002430cb0da5b7982bd2287":{"id":"AWS679f53fac002430cb0da5b7982bd2287","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[{"memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Code":{"id":"Code","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-717494614307-us-west-2","s3Key":"bc8ef58951f4c88e641dd23090e9d2e2e61c7530a07960e767522941e959b625.zip"},"handler":"index.handler","memorySize":512,"role":{"Fn::GetAtt":["AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2","Arn"]},"runtime":"nodejs22.x","timeout":120}}},"LogGroup":{"id":"LogGroup","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.233.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/AWS679f53fac002430cb0da5b7982bd2287/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"AWS679f53fac002430cb0da5b7982bd22872D164C4C"}]]},"retentionInDays":731}}}}}}},"vpc-tgw-attachment":{"id":"vpc-tgw-attachment","path":"TgwWithSiteToSiteVpnStack/vpc-tgw-attachment","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/vpc-tgw-attachment/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnTransitGatewayVpcAttachment","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::TransitGatewayVpcAttachment","aws:cdk:cloudformation:props":{"options":{"ApplianceModeSupport":"disable","DnsSupport":"enable","Ipv6Support":"enable"},"subnetIds":["subnet-095b069ea2f8dae96","subnet-0640a0a54147e3239","subnet-017bb34117eab1589"],"tags":[{"key":"Name","value":"vpc-attachment"}],"transitGatewayId":{"Ref":"tgw23F41D77"},"vpcId":"vpc-069f286e8b8ca3d57"}}}}},"customer-gateway":{"id":"customer-gateway","path":"TgwWithSiteToSiteVpnStack/customer-gateway","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnCustomerGateway","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::CustomerGateway","aws:cdk:cloudformation:props":{"bgpAsn":65001,"ipAddress":"127.0.0.1","type":"ipsec.1"}}},"sitetositevpnConnection":{"id":"sitetositevpnConnection","path":"TgwWithSiteToSiteVpnStack/sitetositevpnConnection","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]},"children":{"preShareKeySecret-pihole-pwd-169.254.250.0--30":{"id":"preShareKeySecret-pihole-pwd-169.254.250.0--30","path":"TgwWithSiteToSiteVpnStack/sitetositevpnConnection/preShareKeySecret-pihole-pwd-169.254.250.0--30","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"preShareKeySecret-pihole-pwd-169.254.251.0--30":{"id":"preShareKeySecret-pihole-pwd-169.254.251.0--30","path":"TgwWithSiteToSiteVpnStack/sitetositevpnConnection/preShareKeySecret-pihole-pwd-169.254.251.0--30","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"VpnConnection":{"id":"VpnConnection","path":"TgwWithSiteToSiteVpnStack/sitetositevpnConnection/VpnConnection","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPNConnection","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPNConnection","aws:cdk:cloudformation:props":{"customerGatewayId":{"Ref":"customergateway"},"staticRoutesOnly":true,"tags":[{"key":"Name","value":"pihole-vpn"}],"transitGatewayId":{"Ref":"tgw23F41D77"},"type":"ipsec.1","vpnTunnelOptionsSpecifications":[{"preSharedKey":"{{resolve:secretsmanager:arn:aws:secretsmanager:us-west-2:717494614307:secret:pihole-pwd:SecretString:::}}","tunnelInsideCidr":"169.254.250.0/30"},{"preSharedKey":"{{resolve:secretsmanager:arn:aws:secretsmanager:us-west-2:717494614307:secret:pihole-pwd:SecretString:::}}","tunnelInsideCidr":"169.254.251.0/30"}]}}}}},"rfc1918-prefix-list":{"id":"rfc1918-prefix-list","path":"TgwWithSiteToSiteVpnStack/rfc1918-prefix-list","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway":{"id":"tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-0e1b5c4a33d9d952d-prefixlist-transitgateway/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ec2:CreateRoute","ec2:DeleteRoute"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwvpnplroute0rtb0e1b5c4a33d9d952dprefixlisttransitgatewayCustomResourcePolicy4364A343","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway":{"id":"tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-0d3c5812eee1ab0e3-prefixlist-transitgateway/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ec2:CreateRoute","ec2:DeleteRoute"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwvpnplroute1rtb0d3c5812eee1ab0e3prefixlisttransitgatewayCustomResourcePolicy14C050C2","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway":{"id":"tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-03fd923d374e6be92-prefixlist-transitgateway/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ec2:CreateRoute","ec2:DeleteRoute"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwvpnplroute2rtb03fd923d374e6be92prefixlisttransitgatewayCustomResourcePolicy1A3FAE1F","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway":{"id":"tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-0-rtb-035c76a2768e67c02-prefixlist-transitgateway/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ec2:CreateRoute","ec2:DeleteRoute"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwvpnplroute0rtb035c76a2768e67c02prefixlisttransitgatewayCustomResourcePolicyDF36AFC1","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway":{"id":"tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-1-rtb-035c76a2768e67c02-prefixlist-transitgateway/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ec2:CreateRoute","ec2:DeleteRoute"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwvpnplroute1rtb035c76a2768e67c02prefixlisttransitgatewayCustomResourcePolicy607A24F6","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway":{"id":"tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/tgw-vpn-pl-route-2-rtb-035c76a2768e67c02-prefixlist-transitgateway/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ec2:CreateRoute","ec2:DeleteRoute"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"tgwvpnplroute2rtb035c76a2768e67c02prefixlisttransitgatewayCustomResourcePolicy1E9D9FD2","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"custom-resource-get-tgw-att-id":{"id":"custom-resource-get-tgw-att-id","path":"TgwWithSiteToSiteVpnStack/custom-resource-get-tgw-att-id","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.233.0"},"children":{"Provider":{"id":"Provider","path":"TgwWithSiteToSiteVpnStack/custom-resource-get-tgw-att-id/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.233.0","metadata":[{"uuid":"*","lambdaPurpose":"*","memorySize":"*","timeout":"*","role":"*","logGroup":"*","functionName":"*","vpc":"*","vpcSubnets":"*","code":"*","handler":"*","runtime":"*"},{"addMetadata":["*",true]},{"addMetadata":["*","*"]}]}},"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/custom-resource-get-tgw-att-id/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.233.0","metadata":["*","*","*"]},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/custom-resource-get-tgw-att-id/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"TgwWithSiteToSiteVpnStack/custom-resource-get-tgw-att-id/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[{"statements":"*"},{"addStatements":[{}]},{"addStatements":[{}]},{"attachToRole":["*"]},{"attachToRole":["*"]}]},"children":{"Resource":{"id":"Resource","path":"TgwWithSiteToSiteVpnStack/custom-resource-get-tgw-att-id/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"ec2:DescribeTransitGatewayAttachments","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"customresourcegettgwattidCustomResourcePolicy80D0EB21","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"vpn-route-0-pihole-vpn-192.168.0.0--16":{"id":"vpn-route-0-pihole-vpn-192.168.0.0--16","path":"TgwWithSiteToSiteVpnStack/vpn-route-0-pihole-vpn-192.168.0.0--16","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnTransitGatewayRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::TransitGatewayRoute","aws:cdk:cloudformation:props":{"destinationCidrBlock":"192.168.0.0/16","transitGatewayAttachmentId":{"Fn::GetAtt":["customresourcegettgwattidEDD8E265","TransitGatewayAttachments.0.TransitGatewayAttachmentId"]},"transitGatewayRouteTableId":{"Fn::GetAtt":["tgwGetDefaultRouteTableId919819F2","TransitGateways.0.Options.AssociationDefaultRouteTableId"]}}}},"CDKMetadata":{"id":"CDKMetadata","path":"TgwWithSiteToSiteVpnStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"TgwWithSiteToSiteVpnStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"TgwWithSiteToSiteVpnStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"TgwWithSiteToSiteVpnStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"}}}}}